<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitácora Diaria - Maxito</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        :root {
            --rojo-suave: #E9584D;
            --rojo-hover: #d64439;
            --casi-negro: #1C1C1E;
            --negro: #000000;
            --gris-oscuro: #2C2C2E;
            --gris-medio: #3A3A3C;
            --gris-claro: #48484A;
            --blanco-suave: #F2F2F7;
            --borde-sutil: rgba(255, 255, 255, 0.12);
            --sombra-principal: 0 20px 40px rgba(0, 0, 0, 0.3);
            --sombra-boton: 0 8px 24px rgba(233, 88, 77, 0.3);
            --azul-ios: #007AFF;
            --verde-ios: #34C759;
            --amarillo-ios: #FFCC00;
            --morado-ios: #AF52DE;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            box-sizing: border-box;
        }
        
        input, textarea, select {
            -webkit-user-select: text;
            user-select: text;
        }
        
        body {
            background: linear-gradient(135deg, var(--negro) 0%, var(--casi-negro) 100%);
            color: var(--blanco-suave);
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container-custom {
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--borde-sutil);
            border-radius: 28px;
            box-shadow: var(--sombra-principal);
            margin: 16px;
            padding: 0;
            max-width: 420px;
            width: calc(100% - 32px);
            overflow: hidden;
        }
        
        /* Header iOS Style */
        .header-ios {
            background: linear-gradient(135deg, 
                rgba(233, 88, 77, 0.15) 0%, 
                rgba(233, 88, 77, 0.08) 50%, 
                rgba(28, 28, 30, 0.95) 100%);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            padding: 24px 24px 32px 24px;
            position: relative;
            overflow: hidden;
        }
        
        .header-ios::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(233, 88, 77, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(233, 88, 77, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .header-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(233, 88, 77, 0.15);
            border: 1px solid rgba(233, 88, 77, 0.3);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            color: var(--rojo-suave);
            margin-bottom: 16px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .header-badge i {
            font-size: 16px;
            animation: heartbeat 2s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .header-title {
            font-size: 36px;
            font-weight: 800;
            letter-spacing: -0.8px;
            line-height: 1.1;
            margin-bottom: 12px;
            background: linear-gradient(135deg, 
                var(--blanco-suave) 0%, 
                rgba(242, 242, 247, 0.9) 40%,
                rgba(233, 88, 77, 0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header-subtitle {
            font-size: 18px;
            font-weight: 500;
            color: rgba(242, 242, 247, 0.7);
            line-height: 1.4;
            margin-bottom: 20px;
        }
        
        .header-stats {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .stat-pill {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 600;
            color: rgba(242, 242, 247, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .stat-pill i {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .stat-pill.time {
            color: var(--azul-ios);
            border-color: rgba(0, 122, 255, 0.3);
        }
        
        .stat-pill.wellness {
            color: var(--verde-ios);
            border-color: rgba(52, 199, 89, 0.3);
        }
        
        .stat-pill.private {
            color: var(--morado-ios);
            border-color: rgba(175, 82, 222, 0.3);
        }
        
        /* Form Content */
        .form-content {
            padding: 32px 24px;
        }
        
        .form-group {
            margin-bottom: 28px;
        }
        
        .form-label {
            display: block;
            font-size: 17px;
            font-weight: 600;
            color: var(--blanco-suave);
            margin-bottom: 12px;
            letter-spacing: -0.2px;
        }
        
        .form-input {
            width: 100%;
            background: var(--gris-oscuro);
            border: 2px solid var(--gris-medio);
            border-radius: 14px;
            padding: 16px;
            font-size: 17px;
            color: var(--blanco-suave);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-appearance: none;
            appearance: none;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--rojo-suave);
            box-shadow: 0 0 0 4px rgba(233, 88, 77, 0.15);
            transform: translateY(-2px);
        }
        
        .form-input::placeholder {
            color: rgba(242, 242, 247, 0.4);
        }
        
        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, var(--rojo-suave) 0%, var(--rojo-hover) 100%);
            border: none;
            border-radius: 16px;
            padding: 20px 24px;
            font-size: 18px;
            font-weight: 600;
            color: white;
            letter-spacing: -0.2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--sombra-boton);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 32px;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(233, 88, 77, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(233, 88, 77, 0.3);
        }
        
        .btn-secondary {
            width: 100%;
            background: var(--gris-oscuro);
            border: 2px solid var(--gris-medio);
            border-radius: 16px;
            padding: 18px 24px;
            font-size: 17px;
            font-weight: 600;
            color: var(--blanco-suave);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-secondary:hover {
            background: var(--gris-medio);
            transform: translateY(-2px);
        }
        
        .energy-slider {
            width: 100%;
            height: 6px;
            background: var(--gris-medio);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            margin: 16px 0;
        }
        
        .energy-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: var(--rojo-suave);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(233, 88, 77, 0.4);
            transition: all 0.2s ease;
        }
        
        .energy-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(233, 88, 77, 0.5);
        }
        
        .energy-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 14px;
            color: rgba(242, 242, 247, 0.6);
        }
        
        .energy-value {
            background: var(--rojo-suave);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 16px;
            min-width: 40px;
            text-align: center;
        }
        
        .radio-group {
            display: grid;
            gap: 12px;
            margin-top: 12px;
        }
        
        .radio-option {
            background: var(--gris-oscuro);
            border: 2px solid var(--gris-medio);
            border-radius: 14px;
            padding: 18px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 14px;
            min-height: 56px;
        }
        
        .radio-option:hover {
            background: var(--gris-medio);
            transform: translateY(-1px);
        }
        
        .radio-option.selected {
            border-color: var(--rojo-suave);
            background: rgba(233, 88, 77, 0.1);
            box-shadow: 0 0 0 1px rgba(233, 88, 77, 0.2);
        }
        
        .radio-option input[type="radio"] {
            width: 22px;
            height: 22px;
            accent-color: var(--rojo-suave);
            margin: 0;
        }
        
        .radio-option label {
            font-size: 16px;
            font-weight: 500;
            color: var(--blanco-suave);
            cursor: pointer;
            flex: 1;
            margin: 0;
        }
        
        .select-wrapper {
            position: relative;
        }
        
        .select-wrapper::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 16px;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(242, 242, 247, 0.6);
            pointer-events: none;
        }
        
        .photo-container {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(233, 88, 77, 0.2);
            margin-bottom: 24px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .photo-container img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .reward-message {
            font-size: 24px;
            font-weight: 600;
            color: var(--blanco-suave);
            text-align: center;
            margin-bottom: 24px;
            letter-spacing: -0.3px;
        }
        
        .love-message {
            font-size: 28px;
            font-weight: 700;
            color: var(--rojo-suave);
            text-align: center;
            margin-bottom: 32px;
            letter-spacing: -0.4px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-content {
            background: var(--gris-oscuro);
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            border: 1px solid var(--borde-sutil);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--gris-medio);
            border-top: 4px solid var(--rojo-suave);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 17px;
            font-weight: 500;
            color: var(--blanco-suave);
        }
        
        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        .status-message {
            margin-top: 16px;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
        }
        
        .status-message.error {
            background: rgba(255, 59, 48, 0.1);
            border: 2px solid rgba(255, 59, 48, 0.3);
            color: #FF3B30;
        }
        
        .status-message.success {
            background: rgba(52, 199, 89, 0.1);
            border: 2px solid rgba(52, 199, 89, 0.3);
            color: #34C759;
        }
        
        .icon {
            font-size: 20px;
            margin-right: 8px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Responsive para pantallas pequeñas */
        @media (max-width: 375px) {
            .container-custom {
                margin: 8px;
                border-radius: 20px;
            }
            
            .header-ios {
                padding: 20px 20px 28px 20px;
            }
            
            .header-title {
                font-size: 30px;
            }
            
            .header-subtitle {
                font-size: 16px;
            }
            
            .form-content {
                padding: 28px 20px;
            }
            
            .form-input {
                padding: 14px;
                font-size: 16px;
            }
            
            .btn-primary {
                padding: 18px 20px;
                font-size: 17px;
            }
            
            .radio-option {
                padding: 16px;
                min-height: 52px;
            }
            
            .header-stats {
                gap: 8px;
            }
            
            .stat-pill {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
        
        /* Pantallas grandes */
        @media (min-width: 768px) {
            .container-custom {
                margin: 32px auto;
                max-width: 440px;
            }
        }
        
        /* Accesibilidad */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex items-center justify-center">
        <div class="container-custom">
            <!-- Página Principal -->
            <div id="main-page" class="fade-in">
                <!-- Header iOS Premium -->
                <div class="header-ios">
                    <div class="header-content">
                        <div class="header-badge">
                            <i class="fas fa-heart"></i>
                            Bienestar Personal
                        </div>
                        
                        <h1 class="header-title">
                            Bitácora Diaria
                        </h1>
                        
                        <p class="header-subtitle">
                            Maxito eres lo más importante.
                        </p>
                        
                        <div class="header-stats">
                            <div class="stat-pill time">
                                <i class="fas fa-clock"></i>
                                1 min
                            </div>
                            <div class="stat-pill wellness">
                                <i class="fas fa-shield-alt"></i>
                                Privado
                            </div>
                            <!--div class="stat-pill private">
                                <i class="fas fa-sparkles"></i>
                                Sorpresa
                            </div>-->
                        </div>
                    </div>
                </div>

                <!-- Form Content -->
                <div class="form-content">
                    <form id="bitacora-form">
                        <!-- Horas de Sueño -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-moon icon"></i>
                                ¿Cuántas horas dormiste anoche?
                            </label>
                            <input 
                                type="number" 
                                id="horas_sueno" 
                                name="horas_sueno" 
                                min="0" 
                                max="24" 
                                class="form-input"
                                placeholder="Ej: 7"
                                required
                            >
                        </div>

                        <!-- Nivel de Energía -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-battery-half icon"></i>
                                Nivel de Energía
                            </label>
                            <input 
                                type="range" 
                                id="nivel_energia" 
                                name="nivel_energia" 
                                min="1" 
                                max="10" 
                                value="5"
                                class="energy-slider"
                            >
                            <div class="energy-display">
                                <span>Muy bajo</span>
                                <div class="energy-value" id="energia-value">5</div>
                                <span>Muy alto</span>
                            </div>
                        </div>

                        <!-- Cambios de Ánimo -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-chart-line icon"></i>
                                Cambios de Ánimo
                            </label>
                            <div class="radio-group">
                                <div class="radio-option" data-value="Muy estable">
                                    <input type="radio" name="cambios_animo" value="Muy estable" id="animo1">
                                    <label for="animo1">Muy estable</label>
                                </div>
                                <div class="radio-option" data-value="Cambios leves">
                                    <input type="radio" name="cambios_animo" value="Cambios leves" id="animo2">
                                    <label for="animo2">Cambios leves</label>
                                </div>
                                <div class="radio-option" data-value="Cambios moderados">
                                    <input type="radio" name="cambios_animo" value="Cambios moderados" id="animo3">
                                    <label for="animo3">Cambios moderados</label>
                                </div>
                                <div class="radio-option" data-value="Muy inestable">
                                    <input type="radio" name="cambios_animo" value="Muy inestable" id="animo4">
                                    <label for="animo4">Muy inestable</label>
                                </div>
                            </div>
                        </div>

                        <!-- Emoción Predominante - Ordenado de más bajo a más alto -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-smile icon"></i>
                                Emoción Predominante
                            </label>
                            <div class="select-wrapper">
                                <select id="emocion_predominante" name="emocion_predominante" class="form-input" required>
                                    <option value="">Selecciona una emoción</option>
                                    <option value="Vacío">Vacío</option>
                                    <option value="Tristeza">Tristeza</option>
                                    <option value="Desánimo/Bajones">Desánimo/Bajones</option>
                                    <option value="Ansiedad">Ansiedad</option>
                                    <option value="Irritabilidad">Irritabilidad</option>
                                    <option value="Estabilidad">Estabilidad</option>
                                    <option value="Euforia">Euforia</option>
                                </select>
                            </div>
                        </div>

                        <!-- Reflexión -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-pen icon"></i>
                                Evento Relevante / Reflexión
                            </label>
                            <textarea 
                                id="evento_reflexion" 
                                name="evento_reflexion" 
                                rows="4" 
                                class="form-input"
                                placeholder="¿Pasó algo significativo hoy o cómo te sientes?"
                                style="resize: none;"
                            ></textarea>
                        </div>

                        <!-- Botón Enviar -->
                        <button type="submit" class="btn-primary" id="submit-btn">
                            <i class="fas fa-paper-plane"></i>
                            Completar Bitácora
                        </button>
                    </form>

                    <!-- Mensaje de estado -->
                    <div id="status-message" class="status-message hidden"></div>
                </div>
            </div>

            <!-- Página de Recompensa -->
            <div id="reward-page" class="fade-in hidden">
                <div class="form-content">
                    <div class="reward-message" id="reward-message">
                        Mira qué pequeño eras...
                    </div>
                    
                    <div class="photo-container">
                        <img id="reward-photo" src="" alt="Foto de recuerdo">
                    </div>
                    
                    <div class="love-message">
                        <i class="fas fa-heart"></i>
                        Te amamos hijito ❤️
                    </div>
                    
                    <button id="new-entry-btn" class="btn-secondary">
                        <i class="fas fa-plus"></i>
                        Nueva Bitácora
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Cargando tu sorpresa...</div>
        </div>
    </div>

    <script>
        class BitacoraMaxito {
            constructor() {
                this.fotos = [
                    'fotos/foto1.jpg', 'fotos/foto2.jpg', 'fotos/foto3.jpg',
                    'fotos/foto4.jpg', 'fotos/foto5.jpg', 'fotos/foto6.jpg',
                    'fotos/foto7.jpg', 'fotos/foto8.jpg', 'fotos/foto9.jpg',
                    'fotos/foto10.jpg', 'fotos/foto11.jpg', 'fotos/foto12.jpg',
                    'fotos/foto13.jpg', 'fotos/foto14.jpg', 'fotos/foto15.jpg'
                ];
                
                this.mensajes = [
                    "Mira qué pequeño eras...",
                    "¿Te acuerdas de este momento?",
                    "Qué hermoso recuerdo...",
                    "Esta sonrisa sigue ahí...",
                    "Momentos que no se olvidan...",
                    "Siempre fuiste especial...",
                    "Mira cuánto has crecido...",
                    "¿Recuerdas esta aventura?"
                ];
                
                this.makeWebhook = 'https://hook.us1.make.com/144onf1g776djfz608m6rl5pu7us4u37';
                this.timeoutId = null;
                this.init();
            }
            
            init() {
                this.setupFormSubmission();
                this.setupEnergySlider();
                this.setupRadioButtons();
                this.setupNewEntryButton();
                this.setupTouchFeedback();
            }
            
            setupFormSubmission() {
                const form = document.getElementById('bitacora-form');
                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.procesarBitacora();
                    });
                }
            }
            
            setupEnergySlider() {
                const slider = document.getElementById('nivel_energia');
                const valueDisplay = document.getElementById('energia-value');
                
                if (slider && valueDisplay) {
                    slider.addEventListener('input', (e) => {
                        valueDisplay.textContent = e.target.value;
                    });
                }
            }
            
            setupRadioButtons() {
                const radioOptions = document.querySelectorAll('.radio-option');
                
                radioOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        radioOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        
                        const radio = option.querySelector('input[type="radio"]');
                        if (radio) {
                            radio.checked = true;
                        }
                    });
                });
            }
            
            setupNewEntryButton() {
                const newEntryBtn = document.getElementById('new-entry-btn');
                if (newEntryBtn) {
                    newEntryBtn.addEventListener('click', () => {
                        this.reiniciarFormulario();
                    });
                }
            }
            
            setupTouchFeedback() {
                const buttons = document.querySelectorAll('.btn-primary, .btn-secondary, .radio-option');
                
                buttons.forEach(button => {
                    button.addEventListener('touchstart', () => {
                        button.style.transform = 'scale(0.98)';
                    });
                    
                    button.addEventListener('touchend', () => {
                        setTimeout(() => {
                            button.style.transform = '';
                        }, 100);
                    });
                });
            }
            
            async procesarBitacora() {
                console.log('Iniciando procesamiento de bitácora...');
                
                if (this.timeoutId) {
                    clearTimeout(this.timeoutId);
                }
                
                try {
                    if (!this.validarFormulario()) {
                        console.log('Formulario no válido');
                        return;
                    }
                    
                    this.mostrarLoading(true);
                    console.log('Loading mostrado');
                    
                    const formData = this.recogerDatos();
                    console.log('Datos recolectados:', formData);
                    
                    const envioPromise = this.enviarDatos(formData);
                    
                    this.timeoutId = setTimeout(() => {
                        console.log('Timeout ejecutado, mostrando sorpresa...');
                        this.mostrarLoading(false);
                        this.mostrarSorpresa();
                    }, 3000);
                    
                    try {
                        await Promise.race([
                            envioPromise,
                            new Promise((_, reject) => 
                                setTimeout(() => reject(new Error('Timeout')), 2500)
                            )
                        ]);
                        console.log('Datos enviados correctamente');
                    } catch (error) {
                        console.log('Error o timeout en envío:', error.message);
                    }
                    
                } catch (error) {
                    console.error('Error general procesando bitácora:', error);
                    this.timeoutId = setTimeout(() => {
                        this.mostrarLoading(false);
                        this.mostrarSorpresa();
                    }, 1000);
                }
            }
            
            validarFormulario() {
                const horasSueno = document.getElementById('horas_sueno').value;
                const cambiosAnimo = document.querySelector('input[name="cambios_animo"]:checked');
                const emocionPredominante = document.getElementById('emocion_predominante').value;
                
                if (!horasSueno) {
                    this.mostrarMensaje('Por favor, ingresa las horas de sueño.', 'error');
                    return false;
                }
                
                if (!cambiosAnimo) {
                    this.mostrarMensaje('Por favor, selecciona los cambios de ánimo.', 'error');
                    return false;
                }
                
                if (!emocionPredominante) {
                    this.mostrarMensaje('Por favor, selecciona la emoción predominante.', 'error');
                    return false;
                }
                
                return true;
            }
            
            recogerDatos() {
                const cambiosAnimo = document.querySelector('input[name="cambios_animo"]:checked');
                
                return {
                    fecha: new Date().toISOString().split('T')[0],
                    horas_sueno: document.getElementById('horas_sueno').value,
                    nivel_energia: document.getElementById('nivel_energia').value,
                    cambios_animo: cambiosAnimo ? cambiosAnimo.value : '',
                    emocion_predominante: document.getElementById('emocion_predominante').value,
                    evento_reflexion: document.getElementById('evento_reflexion').value,
                    timestamp: new Date().toISOString()
                };
            }
            
            async enviarDatos(datos) {
                try {
                    const response = await fetch(this.makeWebhook, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(datos),
                        mode: 'cors'
                    });
                    
                    console.log('Respuesta del webhook:', response.status);
                    return response;
                } catch (error) {
                    console.log('Error enviando datos:', error);
                    throw error;
                }
            }
            
            mostrarSorpresa() {
                console.log('Mostrando sorpresa...');
                
                if (this.timeoutId) {
                    clearTimeout(this.timeoutId);
                    this.timeoutId = null;
                }
                
                const fotoAleatoria = this.fotos[Math.floor(Math.random() * this.fotos.length)];
                const mensajeAleatorio = this.mensajes[Math.floor(Math.random() * this.mensajes.length)];
                
                this.mostrarLoading(false);
                
                document.getElementById('main-page').classList.add('hidden');
                document.getElementById('reward-page').classList.remove('hidden');
                document.getElementById('reward-message').textContent = mensajeAleatorio;
                document.getElementById('reward-photo').src = fotoAleatoria;
                
                console.log('Sorpresa mostrada correctamente');
            }
            
            reiniciarFormulario() {
                if (this.timeoutId) {
                    clearTimeout(this.timeoutId);
                    this.timeoutId = null;
                }
                
                document.getElementById('bitacora-form').reset();
                document.getElementById('energia-value').textContent = '5';
                
                document.querySelectorAll('.radio-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                document.getElementById('reward-page').classList.add('hidden');
                document.getElementById('main-page').classList.remove('hidden');
                
                this.ocultarMensaje();
                this.mostrarLoading(false);
            }
            
            mostrarLoading(mostrar) {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (mostrar) {
                    loadingOverlay.classList.remove('hidden');
                    console.log('Loading overlay mostrado');
                } else {
                    loadingOverlay.classList.add('hidden');
                    console.log('Loading overlay ocultado');
                }
            }
            
            mostrarMensaje(mensaje, tipo) {
                const statusMessage = document.getElementById('status-message');
                statusMessage.textContent = mensaje;
                statusMessage.className = `status-message ${tipo}`;
                statusMessage.classList.remove('hidden');
                
                setTimeout(() => {
                    this.ocultarMensaje();
                }, 5000);
            }
            
            ocultarMensaje() {
                const statusMessage = document.getElementById('status-message');
                statusMessage.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM cargado, inicializando BitacoraMaxito...');
            new BitacoraMaxito();
        });
    </script>
</body>
</html>
